{% extends 'support/base.html' %}
{% load static %}

{% block content %}
<div class="row">
  <!-- Tickets List -->
  <div class="col-md-8">
    <h2 class="mb-3 fw-bold">My Support Tickets</h2>
    
    {% if tickets %}
      <div class="ticket-feed">
        {% for ticket in tickets %}
          <div class="ticket-card">
            
            <!-- Header Row -->
            <div class="card-header-row">
              <div>
                <h6 class="ticket-title">{{ ticket.subject }}</h6>
                <small class="text-muted">
                  By {{ ticket.customer.username }} â€¢ {{ ticket.category.name|default:"General" }}
                </small>
              </div>
              <span class="badge 
                           {% if ticket.status == 'pending' %}badge-warning
                           {% elif ticket.status == 'replied' %}badge-success
                           {% else %}badge-secondary{% endif %}">
                {{ ticket.get_status_display }}
              </span>
            </div>

            <!-- Message -->
            <p class="ticket-message">{{ ticket.message|truncatewords:15 }}</p>

            <!-- Footer Row -->
            <div class="card-footer-row">
              <small class="text-muted">Created: {{ ticket.created_at|date:"M d, Y" }}</small>
              <div class="btn-group" role="group" style="display: flex; justify-content: space-between; width: 100%;">
                <a href="{% url 'customer_ticket_details' ticket.id %}" 
                   class="btn btn-sm btn-outline-primary">View Details</a>
                <form method="post" action="{% url 'delete_ticket' ticket.id %}" class="d-inline">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-sm btn-outline-danger" 
                          onclick="return confirm('Are you sure you want to delete this ticket?')">ðŸ—‘ Delete</button>
                </form>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="text-muted">No tickets submitted yet.</p>
    {% endif %}
  </div>

  <!-- Submit Ticket Form -->
  <div class="col-md-4">
    <div class="ticket-card">
      <h5 class="mb-3 fw-bold">Submit New Ticket</h5>
      <form method="post" class="ticket-form">
        {% csrf_token %}
        <div class="form-group mb-3">
          <label for="{{ form.subject.id_for_label }}" class="form-label">Subject</label>
          {{ form.subject }}
        </div>
        <div class="form-group mb-3">
          <label for="{{ form.message.id_for_label }}" class="form-label">Message</label>
          {{ form.message }}
        </div>
        <div class="form-group mb-3">
          <label for="{{ form.category.id_for_label }}" class="form-label">Category</label>
          {{ form.category }}
        </div>
        <button type="submit" class="btn btn-primary w-100">Submit Ticket</button>
      </form>
    </div>
  </div>
</div>

<style>
/* Feed container */
.ticket-feed {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

/* Ticket Card */
.ticket-card {
  background: #fff;
  border-radius: 8px;
  padding: 14px 18px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.ticket-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 10px rgba(0,0,0,0.12);
}

/* Header + Footer Rows */
.card-header-row, .card-footer-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 6px;
}

/* Title */
.ticket-title {
  margin: 0;
  font-size: 1rem;
  font-weight: 600;
  color: #2c3e50;
}

/* Message */
.ticket-message {
  font-size: 0.9rem;
  color: #444;
  margin: 8px 0 10px 0;
  line-height: 1.4;
}

/* Badges */
.badge {
  font-size: 0.75rem;
  padding: 4px 8px;
  border-radius: 12px;
  font-weight: 500;
}
.badge-warning { background: #ffeeba; color: #856404; }
.badge-success { background: #d4edda; color: #155724; }
.badge-secondary { background: #e2e3e5; color: #383d41; }

/* Form Styling */
.ticket-form .form-label {
  font-weight: 500;
  font-size: 0.9rem;
  margin-bottom: 4px;
  display: block;
}
.ticket-form input, 
.ticket-form textarea, 
.ticket-form select {
  border-radius: 6px;
  font-size: 0.9rem;
  padding: 8px 10px;
  border: 1px solid #ced4da;
  width: 100%;
  box-sizing: border-box;
}
.ticket-form input:focus, 
.ticket-form textarea:focus, 
.ticket-form select:focus {
  border-color: #007bff;
  box-shadow: 0 0 4px rgba(0,123,255,0.25);
  outline: none;
}

/* Buttons */
.btn {
  border-radius: 20px;
  font-weight: 500;
}
</style>
{% endblock %}
